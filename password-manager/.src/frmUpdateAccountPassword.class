' Gambas class file

Public Sub Form_Open()

  ModDB.Connect()

End

Public Sub btnUpdateNewPasswod_Click()

  Dim res As Result
  Dim resVerify As Result ' this will store the login id to copare the password from the DB to the txtcurrentpassword
  
' to check if current password match to the current session id (current user) who is login
  resVerify = ModDB.$Con.Find("login", "ID = &1", ModDB.$CurrentUserID)
  If resVerify.Available And (txtCurrentPassword.text <> resVerify!password) Then
    Message.Warning("Invalid current password", "Try again")
    txtCurrentPassword.SetFocus()
    txtCurrentPassword.Clear()
    txtNewPassword.Clear()
    txtRepeatNewPassword.Clear()
    Return
  Endif
  
  ' to check if new and repeat password match
  If txtNewPassword.Text <> txtRepeatNewPassword.Text Then 
    Message.Warning("New password and repeat new password do not match.", "Try again")
    txtCurrentPassword.SetFocus()
    txtCurrentPassword.Clear()
    txtNewPassword.Clear()
    txtRepeatNewPassword.Clear()
    Return 
  Endif 
  
  ' this triggers the update password
  res = ModDB.$Con.Edit("login", "ID = &1", ModDB.$CurrentUserID)
  If res.Available Then 
    res!password = txtNewPassword.Text
    res.Update()
    Message.Info("Password updated successfully!", "OK")
    Me.Close()
    frmPasswordManager.Show()
  Endif
End

Public Sub chbShowAllPassword_Click()

  If chbShowAllPassword.Value = True Then 
    txtCurrentPassword.Password = False
    txtNewPassword.password = False
    txtRepeatNewPassword.Password = False
  Else 
    txtCurrentPassword.Password = True
    txtNewPassword.password = True
    txtRepeatNewPassword.Password = True
  Endif

End

Public Sub btnBack_Click()

  Me.Close()
  frmPasswordManager.Show()

End

Public Sub Form_Close()

  frmPasswordManager.Show()

End
